<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  
  <title itemprop="name">操作系统 | 天の痕的博客</title>
  
    <link rel="shortcut icon" href="/images/favicon.ico">
  
  <meta http-equiv="x-dns-prefetch-control" content="on">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+SerifMerriweather|Merriweather+Sans|Source+Code+Pro|Ubuntu:400,700|Noto+Serif+SC" media="all">
  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
  <link rel="stylesheet" id="saukra_css-css" href="/css/style.css" type="text/css" media="all">
  <link rel="stylesheet" href="/css/lib.min.css" media="all">
  <link rel="stylesheet" href="/css/font.css" media="all">
  <link rel="stylesheet" href="/css/insight.css" media="all">
  <link rel="stylesheet" href="/css/jquery.fancybox.min.css" media="all">
  <link rel="stylesheet" href="/css/zoom.css" media="all">
  <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<!--   <link rel="stylesheet" id="saukra_css-css" href="https://2heng.xin/wp-content/cache/autoptimize/css/autoptimize_ad42a61f4c7d4bdd9f91afcff6b5dda5.css
" type="text/css" media="all"> -->
  <script>
  /*Initial Variables*/
  var mashiro_option = new Object();
  var mashiro_global = new Object();
  mashiro_option.NProgressON = true;
  /* 
   * 邮箱信息之类的东西可以填在这里，这些js变量基本都作用于sakura-app.js
   * 这样的设置仅是为了方便在基于PHP开发的主题中设置js变量，既然移植到了Node上，我想或许可以精简这一逻辑吧
   */
  mashiro_option.email_domain = "";
  mashiro_option.email_name = "";
  mashiro_option.cookie_version_control = "";
  mashiro_option.qzone_autocomplete = false;
  mashiro_option.site_name = "天痕の轨迹线";
  mashiro_option.author_name = "の轨迹线";
  mashiro_option.site_url = "https://scarofsky.github.io";
  mashiro_option.v_appId = "Eg4LiBqPfNMfvhhF7RBt3YdV-gzGzoHsz";
  mashiro_option.v_appKey = "f5OCYpX4S5HM1oOfq90Yo91S";
  mashiro_option.mathjax = "1";
  mashiro_option.qq_api_url = "https://api.mashiro.top/qqinfo/"; 
  mashiro_option.qq_avatar_api_url = "https://api.mashiro.top/qqinfo/";

  // mashiro_option.jsdelivr_css_src = "https://cdn.jsdelivr.net/gh/moezx/cdn@3.4.5/css/lib.min.css";
  // mashiro_option.float_player_on = true;

  /*End of Initial Variables*/
  </script>
  <script type="text/javascript">
  var bg = "https://cdn.jsdelivr.net/gh/ScarofSky/blogAssets@2.3/img/cover/cover0.jpg,https://cdn.jsdelivr.net/gh/ScarofSky/blogAssets@2.3/img/cover/cover1.jpg,https://cdn.jsdelivr.net/gh/ScarofSky/blogAssets@2.3/img/cover/cover2.jpg,https://cdn.jsdelivr.net/gh/ScarofSky/blogAssets@2.3/img/cover/cover3.jpg,https://cdn.jsdelivr.net/gh/ScarofSky/blogAssets@2.3/img/cover/cover4.jpg,https://cdn.jsdelivr.net/gh/ScarofSky/blogAssets@2.3/img/cover/cover5.jpg,https://cdn.jsdelivr.net/gh/ScarofSky/blogAssets@2.3/img/cover/cover6.jpg".split(",");
  var bgindex = Math.floor(Math.random()*bg.length);
  if (!!window.ActiveXObject || "ActiveXObject" in window) { //is IE?
    alert('朋友，IE浏览器未适配哦~');
  }
  </script>
  <style type="text/css">
  .hljs-ln{border-collapse:collapse}.hljs-ln td{padding:0}.hljs-ln-n:before{content:attr(data-line-number)}
  </style>
  <style type="text/css">.site-top .lower nav{display:block !important;}.author-profile i,.post-like a,.post-share .show-share,.sub-text,.we-info a,span.sitename,.post-more i:hover,#pagination a:hover,.post-content a:hover,.float-content i:hover{color:#FE9600}.feature i,.download,.navigator i:hover,.links ul li:before,.ar-time i,span.ar-circle,.object,.comment .comment-reply-link,.siren-checkbox-radio:checked + .siren-checkbox-radioInput:after{background:#FE9600}::-webkit-scrollbar-thumb{background:#FE9600}.download,.navigator i:hover,.link-title,.links ul li:hover,#pagination a:hover,.comment-respond input[type='submit']:hover{border-color:#FE9600}.entry-content a:hover,.site-info a:hover,.comment h4 a,#comments-navi a.prev,#comments-navi a.next,.comment h4 a:hover,.site-top ul li a:hover,.entry-title a:hover,#archives-temp h3,span.page-numbers.current,.sorry li a:hover,.site-title a:hover,i.iconfont.js-toggle-search.iconsearch:hover,.comment-respond input[type='submit']:hover{color:#FE9600}.comments .comments-main{display:block !important;}.comments .comments-hidden{display:none !important;}background-position:center center;background-attachment:inherit;}
  </style>
</head>
</html>
<body class="page-template page-template-user page-template-page-analytics page-template-userpage-analytics-php page page-id-1297 chinese-font serif isWebKit">
  <div class="scrollbar" id="bar">
  </div>
  <a href="#" class="cd-top faa-float animated"></a>
  <section id="main-container">
    <div class="headertop ">
  <div id="banner_wave_1"></div>
  <div id="banner_wave_2"></div>
  <figure id="centerbg" class="centerbg">
    <div class="focusinfo no-select">
      <div class="header-tou">
        <a href="https://scarofsky.github.io">
          <img src="https://cdn.jsdelivr.net/gh/scarofsky/blogAssets@2.4/img/custom/avatar.jpg">
        </a>
      </div>
      <div class="header-info">
        <p>庄敬日强、功不唐捐。</p>
        <div class="top-social_v2">
          <li id="bg-pre">
            <img class="flipx" src="https://cdn.jsdelivr.net/gh/scarofsky/blogAssets@2.3/img/other/next-b.svg">
          </li>
          
            
              
                <li>
                  <a href="http://github.com/ScarofSky" target="_blank" class="social-github" title="github">
                    <img src="https://cdn.jsdelivr.net/gh/scarofsky/blogAssets@2.4/img/social/github.png">
                  </a>
                </li>
              
            
              
                <li class="wechat">
                  <a href="/#">
                    <img src="https://cdn.jsdelivr.net/gh/scarofsky/blogAssets@2.4/img/social/wechat.png">
                  </a>
                  <div class="wechatInner">
                    <img src="https://cdn.jsdelivr.net/gh/scarofsky/blogAssets@2.4/img/custom/wechat.jpg">
                  </div>
                </li>
              
            
          
          <li id="bg-next">
            <img src="https://cdn.jsdelivr.net/gh/scarofsky/blogAssets@2.3/img/other/next-b.svg">
          </li>
        </div>
      </div>
    </div>
  </figure>
  <div id="video-container" style="">
    <video style="object-fit: fill" id="bgvideo" class="video" video-name="" src="" width="auto" preload="auto">
    </video>
    <div id="video-btn" class="loadvideo videolive">
    </div>
    <div id="video-add">
    </div>
    <div class="video-stu">
    </div>
  </div>
  <div class="headertop-down faa-float animated" onclick="headertop_down()">
    <span>
      <i class="fa fa-chevron-down" aria-hidden="true">
      </i>
    </span>
  </div>
</div>
    <div id="page" class="site wrapper">
      <header class="site-header no-select gizle sabit" role="banner">
  <div class="site-top">
    <div class="site-branding">
      <span class="site-title">
        <span class="logolink moe-mashiro">
          <a href="/">
            <span class="sakurasono">天痕</span>
            <span class="shironeko">の轨迹线</span>
          </a>
        </span>
      </span>
    </div>
    <div class="searchbox search-form-submit">
      <i class="iconfont js-toggle-search iconsearch icon-search">
      </i>
    </div>
    <div id="show-nav" class="showNav mobile-fit">
      <div class="line line1">
      </div>
      <div class="line line2">
      </div>
      <div class="line line3">
      </div>
    </div>
    <div class="lower-cantiner">
      <div class="lower">
        <nav class="mobile-fit-control hide">
          <ul id="menu-new" class="menu">
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
                    首页
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/archives">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
                    归档
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/categories/技术/">
                          <i class="fa fa-code" aria-hidden="true"></i>
                          技术
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/随笔/">
                          <i class="fa fa-commenting-o" aria-hidden="true"></i>
                          随笔
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/读书/">
                          <i class="fa fa-book" aria-hidden="true"></i>
                          读书
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/生活/">
                          <i class="fa fa-file-text-o" aria-hidden="true"></i>
                          生活
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="javascript:;">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
                    清单
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/bangumi/">
                          <i class="fa fa-film faa-vertical" aria-hidden="true"></i>
                          番组
                        </a>
                      </li>
                    
                      <li>
                        <a href="/music/">
                          <i class="fa fa-headphones" aria-hidden="true"></i>
                          歌单
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/comment/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
                    留言板
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/links/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
                    友人帐
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/donate/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-heart faa-pulse" aria-hidden="true"></i>
                    赞赏
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
                    关于
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/about/">
                          <i class="fa fa-meetup" aria-hidden="true"></i>
                          我？
                        </a>
                      </li>
                    
                      <li>
                        <a href="/theme-sakura/">
                          <i class="fa iconfont icon-sakura" aria-hidden="true"></i>
                          主题
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
          </ul>
        </nav>
      </div>
    </div>
  </div>
</header>

      <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
<div class="pattern-center-blank"></div>

  <div class="pattern-center single-center">
    <!-- 有配图默认渲染第一张 -->
    <div class="pattern-attachment-img lazyload" style="background-image: url(https://i.loli.net/2020/06/30/BH8KDoN6Tfjwn4l.jpg);" src="https://cdn.jsdelivr.net/gh/scarofsky/blogAssets@2.3/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://i.loli.net/2020/06/30/BH8KDoN6Tfjwn4l.jpg">
    </div>
    <header class="pattern-header single-header">
      <h1 class="entry-title">
      操作系统</h1>
      <p class="entry-census">
        <span>
          <a href="https://scarofsky.github.io">
            <img src="https://cdn.jsdelivr.net/gh/scarofsky/blogAssets@2.1/img/custom/avatar.jpg">
          </a>
        </span>
        <span>
          <a href="https://scarofsky.github.io">天の痕</a>
        </span>
        <span class="bull">
        ·</span>
        2020-6-30<span class="bull">
        ·</span>
      <span id="busuanzi_value_page_pv"></span>次阅读</p>
    </header>
  </div>

<div id="content" class="site-content">
  <div id="primary" class="content-area">
    <main id="main" class="site-main" role="main">
      <article id="post-1" class="post-1 post type-post status-publish format-standard has-post-thumbnail hentry category-uncategorized">
        <div class="toc"></div>
        <!--<div class="toc-entry-content"><!-- 套嵌目录使用（主要为了支援评论）-->
        
        <div class="entry-content">
          <h1 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h1><h2 id="进程与线程的区别"><a href="#进程与线程的区别" class="headerlink" title="进程与线程的区别"></a>进程与线程的区别</h2><ol>
<li>一个线程只能属于一个进程，而一个进程可以有多个线程，但至少有一个线程。线程依赖于进程而存在。</li>
<li>进程在执行过程中拥有独立的内存单元，而多个线程共享进程的内存。（<strong>资源分配给进程，同一进程的所有线程共享该进程的所有资源</strong>。同一进程中的多个线程共享代码段（代码和常量），数据段（全局变量和静态变量），扩展段（堆存储）。但是每个线程拥有自己的栈段，栈段又叫运行时段，用来存放所有局部变量和临时变量。</li>
<li>进程是CPU<strong>资源分配</strong>的最小单位，线程是CPU<strong>调度</strong>的最小单位；</li>
<li>系统开销： 由于在创建或撤消进程时，系统都要为之分配或回收资源，如内存空间、IO设备等。因此，操作系统所付出的开销将显著地大于在创建或撤消线程时的开销。类似地，在进行进程切换时，涉及到整个当前进程CPU环境的保存以及新被调度运行的进程的CPU环境的设置。而线程切换只须保存和设置少量寄存器的内容，并不涉及存储器管理方面的操作。可见，<strong>进程切换的开销也远大于线程切换的开销</strong>。</li>
<li><strong>线程间比进程间通信更容易</strong>。由于同一进程中的多个线程具有相同的地址空间，致使它们之间的同步和通信的实现，也变得比较容易。进程间通信IPC，线程间可以直接读写进程数据段（如全局变量）来进行通信——需要进程同步和互斥手段的辅助，以保证数据的一致性。在有的系统中，线程的切换、同步和通信都无须操作系统内核的干预。</li>
<li>进程编程<strong>调试简单可靠性高</strong>，但是创建销毁开销大；线程正相反，开销小，切换速度快，但是编程<strong>调试相对复杂</strong>。</li>
<li>进程间不会相互影响 ，而一个线程挂掉将导致整个进程挂掉。</li>
</ol>
<h2 id="进程间通信的方式"><a href="#进程间通信的方式" class="headerlink" title="进程间通信的方式"></a>进程间通信的方式</h2><p>进程间通信主要包括<strong>管道</strong>、<strong>系统IPC</strong>（包括消息队列、信号量、共享内存、信号等）、以及<strong>套接字socket</strong>。</p>
<h3 id="1-管道："><a href="#1-管道：" class="headerlink" title="1.管道："></a><strong>1.管道：</strong></h3><p>管道主要包括<strong>无名管道</strong>和<strong>命名管道</strong>。管道可用于具有亲缘关系的父子进程间的通信，有名管道除了具有管道所具有的功能外，它还允许无亲缘关系进程间的通信。</p>
<p><strong>1.1 普通管道PIPE（无名管道）：</strong></p>
<p>1)它是半双工的（即数据只能在一个方向上流动），具有固定的读端和写端，fd[0] 和fd[1]，0是读端，1是写端。</p>
<p>2)它只能用于具有亲缘关系的进程之间的通信（也是父子进程或者兄弟进程之间）。</p>
<p>3)它可以看成是一种特殊的文件，对于它的读写也可以使用普通的read、write等函数。但是它不是普通的文件，并<strong>不属于其他任何文件系统</strong>，并且<strong>只存在于内存</strong>中。</p>
<p><strong>Linux下实现代码</strong>：</p>
<pre><code class="lang-c++">int main()
{
    char buf[1024]=&quot;change world!\n&quot;;
    int fds[2];
    if(pipe(fds) == -1)
        perror(&quot;pipe&quot;),exit(1);
    pid_t pid = fork(); //创建子进程
    if(pid == 0)//如果是父进程
    {
        close(fds[0]); //关闭管道读描述符
        if(write(fds[1],buf,1024)==-1) //写进管道
            perror(&quot;write&quot;),exit(1);

        close(fds[1]); 
        exit(1);
    }
    else
    {
        memset(buf,0x00,1024);
        close(fds[1]); //关闭管道写描述符
        if(read(fds[0],buf,1024)==-1) //从管道读内容
            perror(&quot;read&quot;),exit(1);
        if(write(1,buf,1024)==-1)
            perror(&quot;write&quot;),exit(1);
        close(fds[0]);
        exit(1);
    }
    return 0;
}
</code></pre>
<p><strong>1.2 命名管道FIFO：</strong></p>
<p>1)FIFO可以在<strong>无关的进程</strong>之间交换数据</p>
<p>2)FIFO有路径名与之相关联，它以一种特殊设备文件形式<strong>存在于文件系统</strong>中。</p>
<p><strong>Linux下实现代码</strong>：</p>
<p>在Linux系统中，使用下边命令创建命名管道</p>
<pre><code class="lang-shell">mkfifo filename
</code></pre>
<pre><code class="lang-shell">[centos@localhost fifo]$ mkfifo myfifo
[centos@localhost fifo]$ ls
myfifo
[centos@localhost fifo]$ file myfifo
myfifo: fifo (named pipe)
</code></pre>
<p>也可以在程序内部创建</p>
<pre><code class="lang-c++">int mkfifo(const char *pathname, mode_t mode);

int main()
{
    mkfifo(&quot;my.p&quot;, 0644);
    return 0;
}
</code></pre>
<p>从命名管道中读入读出</p>
<pre><code class="lang-c++">#include&lt;string.h&gt;
#include&lt;stdlib.h&gt;
#include&lt;unistd.h&gt;
#include&lt;sys/types.h&gt;
#include&lt;sys/stat.h&gt;
#include&lt;fcntl.h&gt;

//读入示例
int main()
{
    mkfifo(&quot;my.p&quot;,0664);//八进制0664 = 110 110 100
    int outfd = open(&quot;my.p&quot;,O_WRONLY);
    if(outfd == -1)
        perror(&quot;open my.txt&quot;),exit(1);
    char buf[1024]={};
    int n = 0;
    while(fgets(buf,1024,stdin))
    {   
        write(outfd,buf,1024);
        memset(buf,0x00,1024);
    }  
    close(outfd);
}

//读出示例
int main()
{
    int infd = open(&quot;my.p&quot;,O_RDONLY);
    if(infd==-1)
        perror(&quot;open my.p&quot;),exit(1);
    char buf[1024]={};
    int n = 0;
    while((n = read(infd,buf,1024))&gt;0)
    {
        write(1,buf,n);
        memset(buf,0x00,1024);
    }
    close(infd);                                                                                                         
    unlink(&quot;my.p&quot;); //删除管道
    return 0;
}
</code></pre>
<p><strong>总结：</strong></p>
<p>匿名管道由pipe函数创建并打开。命名管道由mkfifo函数创建，打开⽤用open。FIFO（命名管道）与pipe（匿名管道）之间唯一的区别在它们创建与打开的⽅方式不同，一但这些工作完成之后，它们具有相同的语义。</p>
<p><a href="https://www.cnblogs.com/zhonglongbo/p/8976730.html" target="_blank" rel="noopener">参考资料.Blog龙跃十二.利用管道实现进程间通信</a></p>
<h3 id="2-系统IPC（Inter-Process-Communication"><a href="#2-系统IPC（Inter-Process-Communication" class="headerlink" title="2.系统IPC（Inter-Process Communication)"></a><strong>2.系统IPC（Inter-Process Communication)</strong></h3><p><strong>2.1 消息队列</strong></p>
<p>消息队列，是消息的链接表，存放在内核中。一个消息队列由一个标识符（即队列ID）来标记。 (消息队列克服了信号传递信息少，管道<strong>只能承载无格式字节流</strong>以及缓冲区大小受限等特点)具有写权限的进程可以按照一定的规则向消息队列中添加新信息；对消息队列有读权限得进程则可以从消息队列中读取信息；</p>
<p>特点：</p>
<p>1)消息队列是面向记录的，其中的消息具有特定的格式以及特定的优先级。</p>
<p>2)消息队列<strong>独立于发送与接收进程</strong>。进程终止时，消息队列及其内容并不会被删除。</p>
<p>3)消息队列可以实现消息的随机查询,消息不一定要以先进先出的次序读取,<strong>也可以按消息的类型读取</strong>。</p>
<p>Linux下消息队列实现主要通过四个函数，msgget(),msgsnd(),msgrcv(),msgctl()。</p>
<pre><code class="lang-c++">#include &lt;sys/types.h&gt;
#include &lt;sys/ipc.h&gt;
#include &lt;sys/msg.h&gt;

//调用成功返回一个key
key_t ftok(const char *pathname, int proj_id);

//创建和获取消息队列
int msgget(key_t key, int msgflg);
//key : 消息队列关联的键，即id, 使用ftok()产生,不同进程通过相同key可以得到相同消息队列
//msgflg ：消息队列的建立标志和存取权限
//IPC_CREAT 单独使用是如果没有就创建 
//IPC_EXCL + IPC_CREAT 是已经存在则执行失败
//返回创建的消息队列的标识符msqid，msqid是IPC对象内部名，失败返回-1
//使用的例子
int open_queue(int keyval)
{
    int qid;
    qid = msgget(keyval, IPC_CREAT | 0666);
    if (qid == -1)
    {
        perror(&quot;Failed in calling msgget&quot;);
        return -1;
    }
    return qid;
}

//发送一条消息到指定的消息队列
int msgsnd(int msqid, const void *msgp, size_t msgsz, int msgflag);
//msqid为消息队列标识符
//msgp指向准备发送消息的指针
//msgsz上述指针指向消息的长度
//msgflag默认为0（IPC_NOWAIT)，表示阻塞，1表示非阻塞。阻塞表示如果队列满了就一直等到有地方，如果非阻塞满了，就直接返回-1。
//消息结构一方面必须小于系统规定的上限，另一方面必须以一个long int长整型开始，接受者以此来确定消息的类型（协议必须的部分）
//实际例子
struct msgbuf
{
    long mtype;
    char mtext[1024];
}

int sendMsgQueue(int msg_id, int who, char* msg)
{
    struct msgbuf buf;
    buf.mtype = who;
    strcpy(buf.mtext, msg);//前目的，后源

    if (msgsnd(msg_id, (void*) &amp;buf, sizeof(buf.mtext), 0) &lt; 0)
    {
        perror(&quot;Fail to send message to MsgQueue!&quot;);
        return -1;
    }
    return 0;
}

//从指定消息队列接收一条消息
int msgrcv(int msqid, const void* msgp, size_t msgsz, long msgtype, int msgflg);
//参数和msgsnd相同

//例子
int recvMsgQueue(int msg_id, int recvType, char out[])
{
    struct msgbuf buf;
    int size = sizeof(buf.mtext);
    if (msgrcv(msg_id, (void*)&amp;buf, size, recvType, 0) &lt; 0)
    {
        perror(&quot;Fail to receive message from MsgQueue!&quot;);
        return -1;
    }

    strncpy(out, buf.mtext, size);//将特定大小的字符串复制
    out[size] = 0;//字符串设置为&#39;\0&#39;
    return 0;
}

//消息控制
int msgctl(int msqid, int cmd, struct msgid_ds *buf);
//msqid是由msgget返回的消息队列id
//cmd有三种值 
//IPC_RMID 删除消息队列
//PIC_STAT 把msgid_ds结构中的数据设置为消息队列的当前关联值
//IPC_SET 在进程有足够权限的前提下，把消息队列的当前关联值设置为msgid_ds数据结构中给出的值

int destoryMsgQueue(int msg_id)
{
    if (msgctl(msg_id, IPC_RMID, NULL) &lt; 0)
    {
        perror(&quot;Remove MsgQueue Fail!&quot;);
        return -1;
    }
    return 0;
}
</code></pre>
<pre><code class="lang-shell">#ipcs 显示IPC资源 -q是消息队列， -m是共享内存
#ipcrm 手动删除IPC资源
[root@localhost code]# ipcs -q
------ Message Queues --------                                                 key        msqid      owner      perms      used-bytes   messages
0x66020001 524288     root       666        0            0

[root@localhost code]# ipcrm -q 524288
[root@localhost code]# ipcs -q
------ Message Queues --------                                                 key        msqid      owner      perms      used-bytes   messages

[root@localhost code]#
</code></pre>
<p><a href="https://blog.csdn.net/wei_cheng18/article/details/79661495" target="_blank" rel="noopener">CSDN. Linux进程间通信之消息队列</a></p>
<p><a href="https://blog.csdn.net/xiaohuangcat/article/details/8203734?locationNum=6" target="_blank" rel="noopener">CSDN. Linux进程通信之消息队列-项目实践</a></p>
<p><strong>2.2 共享内存（Shared Memory）</strong></p>
<p>它使得<strong>多个进程</strong>可以访问同一块内存空间，不同进程可以及时看到对方进程中对共享内存中数据得更新。这种方式需要依靠某种<strong>同步操作</strong>，如互斥锁和信号量等。</p>
<p>特点：</p>
<p>1)共享内存是<strong>最快</strong>的一种IPC，因为进程是直接对内存进行存取。</p>
<p>2)因为多个进程可以同时操作，所以需要进行同步。</p>
<p>3)信号量+共享内存通常结合在一起使用，信号量用来同步对共享内存的访问。</p>
<p>Linux下共享内存机制实现代码，因为是IPC所以很多差不多：</p>
<pre><code class="lang-c++">#include &lt;sys/types.h&gt;
#include &lt;sys/ipc.h&gt;
#include &lt;sys/shm.h&gt;

//建立（获得）一块共享存储区，返回共享存储区的描述符shmid，新建立后初始化为0
//key还是ftok函数生成的
int shmget(key_t key, size_t size, int shmflg);
//这里的key和size与消息队列相同
//shmflg有 IPC_CREAT IPC_EXCL用法同消息队列
//SHM_HUGETLB 使用“huge pages”来分配共享区段
//SHM_NORESERVE 不要为共享区段保留交换空间

//对共享存储区shmid执行操作cmd，对其状态进行修改和控制
int shmctl(int shmid, int cmd, struct shmid_ds *buf);
//cmd有五种，除了消息队列的三种，还多了两种
//IPC_STAT IPC_SET IPC_RMID 删除的时候会等待最后一个使用该存储区的进程终止，但是标识符会立刻删除，无法再使用shmat与该段相连
//SHM_LOCK SHM_UNLOCK 锁住和解锁共享存储区，需要superuser权限

//获得了shmid后，系统需要使用shmat将该共享存储区附接到用户给定的某个进程的虚拟地址
void *shmat(int shmid, const void *addr, int flag);
//addr指定共享内存出现在进程地址的什么位置，指定为NULL可以让内核自己决定
//flag是对于数据的操作，SHM_RDONLY（010000）是只读，其他为读写方式
//成功返回指向共享存储段的指针，错误返回-1（0xffffffff)

//当进程不再需要一个共享存储段时，可以使用shmdt
int shmdt(void * addr);
//addr是调用shmat的返回值
//成功返回0，错误返回-1

//实际例子
struct Info{
    char name[100];
    int age;
};

int main()
{
    key_t key = ftok(&quot;/tmp&quot;, 66);
    int shmid = shmget(key, sizeof(Info), IPC_CREAT|0666);
    Info *p;
    p = (Info *)shmat(shmid, NULL, 0);
    char name[100] = &quot;ScarofSky&quot;;
    int age = 25;
    strcpy(p -&gt; name, name);
    p -&gt; age = age;
    if (shmdt(p) == -1)
    {
        perror(&quot;Dettach Fail!&quot;);
        return -1;
    }

    return 0;
}
</code></pre>
<p>总结：相当于对于共享内存的读写，转换为当前进程中虚拟地址（指针）的读写。</p>
<p><a href="https://blog.csdn.net/qq_27664167/article/details/81277096" target="_blank" rel="noopener">CSDN.Linux下共享内存编程</a></p>
<p><strong>2.3 信号量semaphore</strong></p>
<p>信号量（semaphore）与已经介绍过的 IPC 结构不同，它是一个计数器，可以用来控制多个进程对共享资源的访问。<strong>信号量用于实现进程间的互斥与同步</strong>，而<strong>不是用于存储进程间通信数据</strong>。</p>
<p>特点：</p>
<ol>
<li>信号量用于进程间同步，<strong>若要在进程间传递数据需要结合共享内存</strong>。</li>
<li><p>信号量基于操作系统的 PV 操作，程序对信号量的操作都是<strong>原子操作</strong>。</p>
</li>
<li><p>每次对信号量的 PV 操作不仅限于对信号量值加 1 或减 1，而且<strong>可以加减任意正整数</strong>。</p>
</li>
<li><p>支持信号量组。</p>
</li>
</ol>
<p>PV操作的具体意义：</p>
<ul>
<li>P(s):将信号量value值减1,若结果小于0,则执行P操作的进程被阻塞，若结果大于等于0,则执行P操作的进程将继续执行。</li>
<li>V(s):将信号量的值加1,若结果不大于0,则执行V操作的进程从信号量s有关的list所知队列中释放一个进程，使其转化为就绪态，自己则继续执行，若结果大于0,则执行V操作的进程继续执行。</li>
</ul>
<p>PV操作先对value值加减，再判断和0的关系，之后再决定阻塞和唤醒，是上述逻辑。信号量在Linux中有两种规范，一个是System V标准，另一个是Posix标准。如下的具体代码只涉及Posix标准，System V只列出。</p>
<pre><code class="lang-c++">//System V 标准API

int semget(key_t key, int num_sems, int sem_flags);
int semop(int sem_id, struct sembuf *sops, size_t nsops);
int semctl(int sem_id, int sem_num, int cmd);

//Posix 标准API
#include &quot;semaphore.h&quot;

//初始化一个信号量
int sem_init(sem_t *sem, int pshared, unsigned int value);
//sem为指向信号量结构的一个指针
//pshared != 0在进程间共享，pshared == 0 只在当前进程的所有线程共享
//value是初始值

//等同于V操作
int sem_post(sem_t *sem);
//调用后value ++ , 线程调度策略决定唤醒哪个阻塞的线程

//等同于P操作
int sem_wait(sem_t *sem);
//如果信号量值大于0， 则值-1， 如果值小于等于0，则阻塞当前进程
//if (sem &gt; 0) sem -- ;
//else if (sem &lt;= 0) 
//{
//    sem -- ;
//    sleep();
//}
</code></pre>
<p><a href="https://blog.csdn.net/sunxiaopengsun/article/details/79898884" target="_blank" rel="noopener">CSDN. Linux信号量操作</a></p>
<p><strong>2.4 信号signal</strong></p>
<p>信号是一种比较复杂的通信方式，用于通知接收进程某个事件已经发生。</p>
<p><strong>软中断</strong>信号（signal，又简称为信号）用来通知进程发生了异步事件。<strong>在软件层次上是对中断机制的一种模拟</strong>，在原理上，一个进程收到一个信号与处理器收到一个中断请求可以说是一样的。信号是进程间通信机制中唯一的异步通信机制，一个进程不必通过任何操作来等待信号的到达，事实上，进程也不知道信号到底什么时候到达。进程之间可以互相通过系统调用kill发送软中断信号。内核也可以因为内部事件而给进程发送信号，通知进程发生了某个事件。信号机制除了基本通知功能外，还可以传递附加信息。</p>
<p><a href="https://www.cnblogs.com/sky-heaven/p/10176422.html" target="_blank" rel="noopener">Blog.sky</a></p>
<p><strong>3.套接字SOCKET：</strong></p>
<p>socket也是一种进程间通信机制，与其他通信机制不同的是，它可用于不同主机之间的进程通信。</p>
<p><a href="https://blog.csdn.net/kkkkde/article/details/81698124" target="_blank" rel="noopener">CSDN.Linux网络编程 套接字编程</a></p>
<h2 id="线程间通信的方式"><a href="#线程间通信的方式" class="headerlink" title="线程间通信的方式"></a><strong>线程间通信的方式</strong></h2><p>临界区：通过多线程的串行化来访问公共资源或一段代码，速度快，适合控制数据访问；</p>
<p>互斥量Synchronized/Lock：采用互斥对象机制，只有拥有互斥对象的线程才有访问公共资源的权限。因为互斥对象只有一个，所以可以保证公共资源不会被多个线程同时访问</p>
<p>信号量Semphare：为控制具有有限数量的用户资源而设计的，它允许多个线程在同一时刻去访问同一个资源，但一般需要限制同一时刻访问此资源的最大线程数目。</p>
<p>事件(信号)，Wait/Notify：通过通知操作的方式来保持多线程同步，还可以方便的实现多线程优先级的比较操作。</p>
<h2 id="死锁的必要条件和解决方法"><a href="#死锁的必要条件和解决方法" class="headerlink" title="死锁的必要条件和解决方法"></a>死锁的必要条件和解决方法</h2><p>死锁是指两个或两个以上进程在执行过程中，因争夺资源而造成的下相互等待的现象。死锁发生的四个必要条件如下：</p>
<ol>
<li>互斥条件：进程对所分配到的资源不允许其他进程访问，若其他进程访问该资源，只能等待，直至占有该资源的进程使用完成后释放该资源。</li>
<li>占有和等待：进程获得一定的资源后，又对其他资源发出请求，但是该资源可能被其他进程占有，此时请求阻塞，但该进程不会释放自己已经占有的资源。</li>
<li>非抢占：进程已获得的资源，在未完成使用之前，不可被剥夺，只能在使用后自己释放。</li>
<li>循环等待：进程发生死锁后，必然存在一个进程-资源之间的环形链。</li>
</ol>
<p>死锁的处理方法是<strong>死锁预防</strong>、<strong>死锁避免</strong>、<strong>死锁检测</strong>和<strong>死锁恢复</strong>。</p>
<ul>
<li>死锁预防的方法：</li>
</ul>
<ol>
<li><strong>资源一次性分配</strong>，从而剥夺占有并等待条件。当一个进程申请一个资源时，它不能占有其他资源。缺点是资源利用率低和可能发生饥饿，当资源一次性分配之后，可能有些最后才用到；如果进程需要多个常用资源，可能会发生饥饿导致一直分配不到资源，一直等待。</li>
<li><strong>抢占式协议</strong>：如果一个进程占有资源并申请另一个不能立即分配的资源，那么现在已经分配的资源允许其他进程抢占。换句话说，这些资源被<strong>隐式释放</strong>了。如果有新的进程请求资源，那么系统先考虑自由资源，再考虑等待中进程的资源，如果都不够，那么该进程也进入等待。</li>
<li><strong>资源有序分配法</strong>：系统给每类资源赋予一个序号，每个进程按编号递增的请求资源，释放则相反，从而破坏环路等待的条件。</li>
</ol>
<ul>
<li>死锁避免的方法：获得以后进程如何申请资源的附加信息，由操作系统来综合考虑如何分配资源，使用已有的死锁避免算法。</li>
</ul>
<ol>
<li>安全状态</li>
<li>资源分配图算法（每种资源都有单个实例）</li>
<li>银行家算法（每种资源有多个实例）</li>
</ol>
<ul>
<li>死锁检测和恢复的方法：系统提供检测算法 + 恢复算法</li>
</ul>
<h2 id="缺页置换算法"><a href="#缺页置换算法" class="headerlink" title="缺页置换算法"></a>缺页置换算法</h2><p>当访问一个内存中不存在的页，并且内存已满，则需要从内存中调出一个页或将数据送至磁盘对换区，替换一个页，这种现象叫做缺页置换。当前操作系统最常采用的缺页置换算法如下：</p>
<ol>
<li>先进先出（FIFO)算法：置换最先调入内存的页面，即置换在内存中驻留时间最久的页面。按照进入内存的先后顺序排列。</li>
<li>最近最少使用（LRU)算法：置换最近一段时间以来最长时间未访问过的页面。根据程序局部性原理，刚被访问的页面，可能马上又要被访问；而较长时间内没有被访问的页面，可能最近不会被访问。被使用的页就会被刷新，放到最近的位置，长时间未被使用的就会慢慢排到最后。</li>
</ol>
<h2 id="并发和并行"><a href="#并发和并行" class="headerlink" title="并发和并行"></a>并发和并行</h2><ul>
<li>并发（concurrency）：指宏观上看起来两个程序在同时运行，比如说在<strong>单核CPU上的多任务</strong>。但是从微观上看两个程序的指令是交织着运行的，你的指令之间穿插着我的指令，我的指令之间穿插着你的，在单个周期内只运行了一个指令。这种并发并不能提高计算机的性能，只能提高效率。</li>
<li>并行（parallelism）：指<strong>严格物理意义上的同时运行</strong>，比如多核CPU，两个程序分别运行在两个核上，两者之间互不影响，单个周期内每个程序都运行了自己的指令，也就是运行了两条指令。这样说来并行的确提高了计算机的效率。所以现在的cpu都是往多核方面发展。</li>
</ul>
<h2 id="大端序和小端序"><a href="#大端序和小端序" class="headerlink" title="大端序和小端序"></a>大端序和小端序</h2><p><strong>大端是指低字节存储在高地址；小端存储是指低字节存储在低地址。</strong>我们可以根据联合体来判断该系统是大端还是小端。因为联合体变量总是从低地址存储。</p>
<pre><code class="lang-c++">//判断系统是大端序还是小端序
int fun1()
{
    union  test
    {
        int i;
        char c;
    };

    test t;
    t.i = 1;
    return (t.c == 1);
}
</code></pre>
<p>比如0x12345678如果是小端序，存储地址从低到高应该是78 56 34 12，如果是大端序，从低到高地址存储应该是12 34 56 78。</p>
<p>大端序：</p>
<p>低地址 ——————————&gt; 高地址<br>0x12  |  0x34  |  0x56  |  0x78</p>
<p>小端序：</p>
<p>低地址 ——————————&gt; 高地址<br>0x78  |  0x56  |  0x34  |  0x12</p>
<h2 id="内核态和用户态"><a href="#内核态和用户态" class="headerlink" title="内核态和用户态"></a>内核态和用户态</h2><h2 id="内存管理"><a href="#内存管理" class="headerlink" title="内存管理"></a>内存管理</h2><h2 id="CPP到EXE过程"><a href="#CPP到EXE过程" class="headerlink" title="CPP到EXE过程"></a>CPP到EXE过程</h2><h3 id="预处理"><a href="#预处理" class="headerlink" title="预处理"></a>预处理</h3><ol>
<li>删除注释</li>
<li>宏替换，#define删除并且替换所有的宏定义位置的值</li>
<li>处理所有条件预编译指令，#if #ifdef #endif #elif #else，处理#include，将包含的文件直接复制到当前位置。保留#pragma的编译指令，编译器会使用</li>
<li>添加行号和文件名表示，以便于调试时能显示编译错误或警告产生。</li>
</ol>
<h3 id="编译过程"><a href="#编译过程" class="headerlink" title="编译过程"></a>编译过程</h3><ol>
<li>词法分析</li>
<li>语法分析</li>
<li>语义分析与中间代码生成</li>
<li>优化（对于中间代码）</li>
<li>目标代码生成</li>
</ol>
<p>目标代码的形式可以是<strong>绝对指令代码</strong>或<strong>可重定位的指令代码</strong>或<strong>汇编指令代码</strong>。</p>
<p>如目标代码是绝对指令代码，则这种目标代码可立即执行。</p>
<p>如果目标代码是汇编指令代码，则需汇编器汇编之后才行运行。</p>
<p>现在多数实用编译程序所产生的目标代码都是一种可重定位的指令代码。这种目标代码在运行前必须借助于一个连接装配程序（<strong>链接器</strong>）把各个目标模块（包括系统提供的库函数）连接在一起，确定程序变量（或常数）在主存中的位置，装入内存中指定的起始地址，使之<strong>成为一个可以运行的绝对指令代码程序</strong>。</p>
<p><a href="https://blog.csdn.net/wilsonpeng3/article/details/21327667" target="_blank" rel="noopener">Blog.CSDN 编译过程的五个阶段</a></p>
<h3 id="汇编"><a href="#汇编" class="headerlink" title="汇编"></a>汇编</h3><p>将汇编语言翻译成二进制代码，构建可重定位的二进制文件（.o/.obj文件）。</p>
<h3 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h3><p>链接主要是将多个文件编译出来的.o文件合成最终的可执行程序，这样可以将程序按照模块开发，降低开发的难度。这样会带来问题是不同文件会互相使用其他文件中定义的全局变量和函数，编译时只能解决当前文件中地址，但是真实运行时的具体地址，要靠链接器来决定。</p>
<p><strong>可重定位目标文件</strong>中包含代码和数据，即.text段.data段.bss段。同时也包括<strong>符号表</strong>来提供链接时需要的信息。</p>
<ol>
<li>合并段。</li>
<li>调整段地址偏移量和段长度。</li>
<li>合并所有的符号：进行符号解析。</li>
<li>空间与地址的分配。</li>
<li>符号重定位。</li>
</ol>
<p>可执行文件加载到内存之后的分布：</p>
<p><img src="https://img2018.cnblogs.com/blog/1193092/201904/1193092-20190424125528050-1062178045.png" alt></p>
<p><a href="https://www.cnblogs.com/snsart/p/10761642.html" target="_blank" rel="noopener">Blog.snsart 文件的链接过程</a></p>

        </div>
        <!-- .entry-content -->
        <div class="single-reward">
          <div class="reward-open">赏
            <div class="reward-main">
              <ul class="reward-row">
                <li class="alipay-code"><img src="https://cdn.jsdelivr.net/gh/scarofsky/blogAssets@2.4/img/custom/donate/AliPayQR.jpg"></li>
                <li class="wechat-code"><img src="https://cdn.jsdelivr.net/gh/scarofsky/blogAssets@2.4/img/custom/donate/WeChanQR.jpg"></li>
              </ul>
            </div>
          </div>
        </div>
        <div style="text-align:center; width: 100%" class="social-share share-mobile" data-disabled="diandian, tencent"></div>
        <footer class="post-footer">
          <div class="post-lincenses"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="nofollow"><i class="fa fa-creative-commons" aria-hidden="true"></i> 知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a></div>
          <div class="post-tags">
          </div>
          <div class="post-share">
            <div class="social-share sharehidden share-component"></div>
            <i class="iconfont show-share icon-forward"></i>
          </div>
        </footer><!-- .entry-footer -->
      </article>
      <!-- #post-## -->
      <div class="toc" style="background: none;"></div>
      <section class="post-squares nextprev">
        
          
            <div class="post-nepre half previous">
          
            <a href="/2020/07/01/算法/DFS/" rel="prev">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/scarofsky/blogAssets@2.3/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://i.loli.net/2020/07/01/kmc7IaA34hPK1Us.jpg" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="https://i.loli.net/2020/07/01/kmc7IaA34hPK1Us.jpg">
              </div>
              <span class="label">
              Previous Post</span>
              <div class="info">
                <h3>
                DFS</h3>
                <hr>
              </div>
            </a>
          </div>
        
        
          
            <div class="post-nepre half next">
          
            <a href="/2020/06/30/算法/动态规划（二）其他DP/" rel="next">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/scarofsky/blogAssets@2.3/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://i.loli.net/2020/06/30/aFtNCbT1Sn6IQ7h.jpg" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="https://i.loli.net/2020/06/30/aFtNCbT1Sn6IQ7h.jpg">
              </div>
              <span class="label">
              Next Post</span>
              <div class="info">
                <h3>
                动态规划（二）其他DP</h3>
                <hr>
              </div>
            </a>
          </div>
        
      </section>
      
<div id="vcomments"></div>
<script>
  window.onload = function(){
      var valine = new Valine();
      valine.init({
        el: '#vcomments',
        appId: "Eg4LiBqPfNMfvhhF7RBt3YdV-gzGzoHsz",
        appKey: "f5OCYpX4S5HM1oOfq90Yo91S",
        path: window.location.pathname,
        placeholder: "你是我一生只会遇见一次的惊喜 ..."
      })
  }
</script>

      <section class="author-profile">
        <div class="info" itemprop="author" itemscope="" itemtype="https://schema.org/Person">
          <a href="https://scarofsky.github.io" class="profile gravatar"><img src="https://cdn.jsdelivr.net/gh/scarofsky/blogAssets@2.1/img/custom/avatar.jpg" itemprop="image" alt="天の痕" height="70" width="70"></a>
          <div class="meta">
            <span class="title">Author</span>
            <h3 itemprop="name">
            <a href="https://scarofsky.github.io" itemprop="url" rel="author">天の痕</a>
            </h3>
          </div>
        </div>
        <hr>
        <p><i class="iconfont icon-write"></i>庄敬日强，功不唐捐。</p>
      </section>
    </main><!-- #main -->
  </div><!-- #primary -->
</div>



    </div>    
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="请输入关键词..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            // PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
    <!-- <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 天の痕<br>
      powered_by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer> -->
<footer id="colophon" class="site-footer" role="contentinfo">
  <div class="site-info">
    <div class="footertext">
      <div class="img-preload">
        <img src="https://cdn.jsdelivr.net/gh/scarofsky/blogAssets@2.3/img/other/wordpress-rotating-ball-o.svg">
        <img src="https://cdn.jsdelivr.net/gh/scarofsky/blogAssets@2.3/img/other/disqus-preloader.svg">
      </div>
      <p style="color: #666666;">&copy 2020</p>
    </div>
    <div class="footer-device">
    <p style="font-family: 'Ubuntu', sans-serif;">
        <span style="color: #b9b9b9;">Theme <a href="https://github.com/honjun/hexo-theme-sakura" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Sakura</a> <i class="iconfont icon-sakura rotating" style="color: #ffc0cb;display:inline-block"></i> by <a href="https://2heng.xin/" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Mashiro</a>&<a href="https://www.hojun.cn/" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Hojun</a>, Powered by Hexo, Hosted by Coding Pages</a>
        </span>
      </p>
    </div>
  </div><!-- .site-info -->
</footer>



<!-- <script src="/js/tocbot.js"></script> -->
<script type="text/javascript" src="/js/lib.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script type="text/javascript" src="/js/InsightSearch.js"></script>
<script type="text/javascript" src="/js/jquery.fancybox.min.js"></script>
<script type="text/javascript" src="/js/zoom.min.js"></script>
<script type="text/javascript" src="/js/sakura-app.js"></script>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine@1.3.4/dist/Valine.min.js'></script>
<script src="/js/botui.js"></script>
<!-- 不蒜子 网页计数器 -->
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script> -->
<script type="text/javascript">
/* <![CDATA[ */
if (/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  var Poi = {"pjax":"1","movies":{"url": "https://cdn.jsdelivr.net/gh/scarofsky/blogVideo@1.2/","name":"op.mp4","live":"close"},"windowheight":"fixed","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
} else {
  var Poi = {"pjax":"1","movies":{"url": "https://cdn.jsdelivr.net/gh/scarofsky/blogVideo@1.2/","name":"op.mp4","live":"open"},"windowheight":"auto","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
}
/* ]]> */

</script>
<script>
$(document).ready(function() {
  if ($(".toc").length > 0 && document.body.clientWidth > 1200) {
    if ($(".pattern-center").length > 0) { //有图的情况
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -400,
          scrollSmoothOffset: -85
      });
    } else {
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -85,
          scrollSmoothOffset: -85
      });
    }
    var offsetTop = $('.toc').offset().top - 95;
    window.onscroll = function() {
      var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
      if (scrollTop >= offsetTop) {
        $('.toc').addClass('toc-fixed');
      } else {
        $('.toc').removeClass('toc-fixed');
      }
    }
  }
});
</script>

    <div class="openNav no-select" style="height: 50px;">
      <div class="iconflat no-select" style="width: 50px; height: 50px;">
        <div class="icon"></div>
      </div>
      <div class="site-branding search-form-submit">
        <i class="iconfont js-toggle-search iconsearch icon-search"></i>
      </div>
    </div>
  </section>
  <div id="mo-nav" class="">
  <div class="m-avatar">
    <img src="https://cdn.jsdelivr.net/gh/scarofsky/blogAssets@2.4/img/custom/avatar.jpg">
  </div>
  <p style="text-align: center; color: #333; font-weight: 900; font-family: 'Ubuntu', sans-serif; letter-spacing: 1.5px">天痕の轨迹线</p>
  <p style="text-align: center; word-spacing: 20px;">
    
      
        <a href="http://github.com/ScarofSky" class="fa fa-github" target="_blank" style="color: #333; margin-left:20px"></a>
      
        <a href="/#" class="fa " target="_blank" style="color: #; margin-left:20px"></a>
      
    
  </p>
  <ul id="menu-new-1" class="menu">
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
            首页
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/archives">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
            归档
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/categories/技术/">
                  <i class="fa fa-code" aria-hidden="true"></i>
                  技术
                </a>
              </li>
            
              <li>
                <a href="/categories/随笔/">
                  <i class="fa fa-commenting-o" aria-hidden="true"></i>
                  随笔
                </a>
              </li>
            
              <li>
                <a href="/categories/读书/">
                  <i class="fa fa-book" aria-hidden="true"></i>
                  读书
                </a>
              </li>
            
              <li>
                <a href="/categories/生活/">
                  <i class="fa fa-file-text-o" aria-hidden="true"></i>
                  生活
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="javascript:;">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
            清单
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/bangumi/">
                  <i class="fa fa-film faa-vertical" aria-hidden="true"></i>
                  番组
                </a>
              </li>
            
              <li>
                <a href="/music/">
                  <i class="fa fa-headphones" aria-hidden="true"></i>
                  歌单
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/comment/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
            留言板
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/links/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
            友人帐
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/donate/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-heart faa-pulse" aria-hidden="true"></i>
            赞赏
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
            关于
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/about/">
                  <i class="fa fa-meetup" aria-hidden="true"></i>
                  我？
                </a>
              </li>
            
              <li>
                <a href="/theme-sakura/">
                  <i class="fa iconfont icon-sakura" aria-hidden="true"></i>
                  主题
                </a>
              </li>
            
          </ul>
        
      </li>
    
  </ul>
  <p style="text-align: center; font-size: 13px; color: #b9b9b9;">&copy 2019 hexo-sakura</p>
</div>
<button onclick="topFunction()" class="mobile-cd-top" id="moblieGoTop" title="Go to top" style="display: none;"><i class="fa fa-chevron-up" aria-hidden="true"></i></button>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
<!-- require MetingJS -->
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
<style>
  .aplayer .aplayer-lrc {
    height: 35px;
  }
  .aplayer .aplayer-lrc p{
    font-size: 16px;
    font-weight: 700;
    line-height: 18px !important;
  }
  .aplayer .aplayer-lrc p.aplayer-lrc-current{
    color: #FF1493;
  }
  .aplayer.aplayer-narrow .aplayer-body{
    left: -66px !important;
  }
  .aplayer.aplayer-fixed .aplayer-lrc {
    display: none;
  }
  .aplayer .aplayer-lrc.aplayer-lrc-hide {
      display:none !important;
  }
  .aplayer.aplayer-fixed .lrc-show {
    display: block;
    background: rgba(255, 255, 255, 0.8);
  }
</style>
<meting-js

    id="5047109214"

    server="netease"

    type="playlist"

    fixed="true"

    autoplay="false"

    loop="all"

    order="random"

    preload="auto"

    volume="0.7"

    mutex="true"

</meting-js>
<script>
  $(function(){
    $('body').on('click', '.aplayer', function(){
      if($('.aplayer-button').hasClass('aplayer-play')) {
        $('.aplayer-lrc').removeClass('lrc-show');
      } else {
        $('.aplayer-lrc').addClass('lrc-show');
      }
    })
  });
</script>
</body>
</html>